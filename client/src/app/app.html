<main class="layout">
  <section class="card">
    <header class="card__header">
      <h1>Patient Intake</h1>
      <p class="card__subtitle">
        Provide the basic patient details and chief complaint to generate a clinical intake summary.
      </p>
    </header>

    <form class="form" [formGroup]="intakeForm" (ngSubmit)="submit()" novalidate>
      <div class="form__group">
        <label class="form__label" for="age">Age</label>
        <input
          id="age"
          type="number"
          formControlName="age"
          inputmode="numeric"
          min="0"
          max="140"
          [class.form__control--invalid]="intakeForm.controls.age.invalid && intakeForm.controls.age.touched"
          class="form__control"
        />
        @if (intakeForm.controls.age.hasError('required') && intakeForm.controls.age.touched) {
          <p class="form__error">
            Age is required.
          </p>
        }
        @if ((intakeForm.controls.age.hasError('min') || intakeForm.controls.age.hasError('max')) && intakeForm.controls.age.touched) {
          <p class="form__error">
            Age must be between 0 and 140.
          </p>
        }
      </div>

      <div class="form__group">
        <label class="form__label" for="gender">Gender</label>
        <select
          id="gender"
          formControlName="gender"
          class="form__control"
          [class.form__control--invalid]="intakeForm.controls.gender.invalid && intakeForm.controls.gender.touched"
        >
          @for (option of genders(); track option) {
            <option [value]="option">{{ option }}</option>
          }
        </select>
        @if (intakeForm.controls.gender.hasError('required') && intakeForm.controls.gender.touched) {
          <p class="form__error">
            Gender is required.
          </p>
        }
      </div>

      <div class="form__group">
        <label class="form__label" for="chiefComplaint">Chief Complaint</label>
        <textarea
          id="chiefComplaint"
          formControlName="chiefComplaint"
          rows="5"
          class="form__control form__control--textarea"
          [class.form__control--invalid]="intakeForm.controls.chiefComplaint.invalid && intakeForm.controls.chiefComplaint.touched"
        ></textarea>
        @if (intakeForm.controls.chiefComplaint.hasError('required') && intakeForm.controls.chiefComplaint.touched) {
          <p class="form__error">
            Chief complaint is required.
          </p>
        }
        @if (intakeForm.controls.chiefComplaint.hasError('maxlength') && intakeForm.controls.chiefComplaint.touched) {
          <p class="form__error">
            Chief complaint must be 1000 characters or fewer.
          </p>
        }
      </div>

      <div class="form__actions">
        <button type="submit" class="button button--primary" [disabled]="isSubmitting()">
          {{ isSubmitting() ? 'Submittingâ€¦' : 'Generate Summary' }}
        </button>
        <button type="button" class="button button--secondary" (click)="resetForm()" [disabled]="isSubmitting()">
          Reset
        </button>
      </div>
    </form>

    @if (submissionResult(); as result) {
      <section class="result result--success">
        <h2>Suggested Intake Summary</h2>
        <p class="result__model">Model: {{ result.model }}</p>
        <pre class="result__text">{{ result.answer }}</pre>
      </section>
    }

    @if (submissionError(); as error) {
      <section class="result result--error">
        <h2>Submission Failed</h2>
        <p>{{ error }}</p>
      </section>
    }
  </section>
</main>
